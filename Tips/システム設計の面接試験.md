# 知見
- [知見](#知見)
  - [ユーザ数ゼロから数百万人へのスケールアップ](#ユーザ数ゼロから数百万人へのスケールアップ)
    - [ステートレスなWeb層とは](#ステートレスなweb層とは)
  - [おおまかな見積もり](#おおまかな見積もり)
  - [システム設計の面接試験のフレームワーク](#システム設計の面接試験のフレームワーク)
  - [レートリミッターの設計](#レートリミッターの設計)
    - [レートリミッターとは](#レートリミッターとは)
  - [コンシステントハッシュの設計](#コンシステントハッシュの設計)
    - [コンシステントハッシュとは](#コンシステントハッシュとは)
  - [キーバリューストアの設計](#キーバリューストアの設計)
    - [キーバリューストアとは](#キーバリューストアとは)
  - [分散システムにおけるユニークIDジェネレータの設計](#分散システムにおけるユニークidジェネレータの設計)
  - [URL短縮サービスの設計](#url短縮サービスの設計)
  - [Webクローラの設計](#webクローラの設計)
  - [通知システムの設計](#通知システムの設計)
  - [ニュースフェードシステムの設計](#ニュースフェードシステムの設計)
  - [チャットシステムの設計](#チャットシステムの設計)
  - [検索オートコンプリートシステムの設計](#検索オートコンプリートシステムの設計)
  - [YouTubeの設計](#youtubeの設計)
  - [Googleドライブの設計](#googleドライブの設計)
  - [設計を学んでいくための手順](#設計を学んでいくための手順)
      - [用語辞典](#用語辞典)
        - [データベースレプリケーション](#データベースレプリケーション)
        - [キャッシュ](#キャッシュ)
    - [**1. Memcached**](#1-memcached)
    - [**2. Redis**](#2-redis)
    - [**3. Varnish**](#3-varnish)
    - [**4. Apache Kafka**](#4-apache-kafka)
    - [**5. Nginx（キャッシュ機能）**](#5-nginxキャッシュ機能)
    - [**6. AWS ElastiCache**](#6-aws-elasticache)
    - [**7. Squid**](#7-squid)
    - [**比較表**](#比較表)
        - [CDN(Contents Delivery Network)](#cdncontents-delivery-network)
        - [メッセージキュー](#メッセージキュー)
        - [垂直スケーリング(スケールアップ)](#垂直スケーリングスケールアップ)
        - [水平スケーリング(シャーディング)](#水平スケーリングシャーディング)
        - [NoSQL(非リレーショナルデータベース)](#nosql非リレーショナルデータベース)
        - [CAP定理](#cap定理)


## ユーザ数ゼロから数百万人へのスケールアップ
システムをスケールアップするために取るべき一般的な観点は以下である。
- Web層はステートレスに保つ
- 各階層で冗長性を確保する
- できる限りデータをキャッシュする
- 複数のデータセンターへの対応
- 静的アセットをCDNでホスティング
- シャーディングによるデータ層の拡張
- 各サービスに階層を分割する
- システム監視と自動化ツールの使用

### ステートレスなWeb層とは
ユーザーの状態データなど、状態データをリレーショナルデータベースやNoSQLのようなストレージに保存すること。


## おおまかな見積もり
## システム設計の面接試験のフレームワーク
## レートリミッターの設計
### レートリミッターとは

## コンシステントハッシュの設計
### コンシステントハッシュとは

## キーバリューストアの設計
### キーバリューストアとは

## 分散システムにおけるユニークIDジェネレータの設計
## URL短縮サービスの設計
## Webクローラの設計
## 通知システムの設計
## ニュースフェードシステムの設計
## チャットシステムの設計
## 検索オートコンプリートシステムの設計
## YouTubeの設計
## Googleドライブの設計
## 設計を学んでいくための手順

#### 用語辞典
##### データベースレプリケーション
マスターDBと、マスターDBをコピーしたスレーブDBから成るDB構成で、
マスターDB: `INSERT`, `UPDATE`, `DELETE`といったデータ更新処理はマスターDBが受け付け。
スレーブDB: `SELECT`のみ受け付ける。

DBサーバを複数用意する構成なので、可用性や信頼性が高い。

書き込みや更新と読み込みがマスターとスレーブで役割が分かれていて、
より多くのクエリが並列処理できるので、パフォーマンスが向上する。


マスターDBがオフラインになった場合、スレーブDBを一時的にマスターDBとして利用するが、
スレーブDBが最新でない可能性があるので、データ復旧スクリプトを別途実行して、不足しているデータを更新するといった対応が必要になる場合がある。

##### キャッシュ
キャッシュサーバとして使用される代表的なツールを以下に説明します。それぞれの特徴や用途を簡単にまとめました。

---

### **1. Memcached**
- **概要**:
  - 高速で軽量な分散型キャッシュシステム。
  - 主にメモリ内にデータを保存し、データベースやAPIの負荷を軽減します。
- **特徴**:
  - キーと値のペアでデータを保存するシンプルな設計。
  - スケーラブルで、複数のサーバに分散可能。
  - データは揮発性（サーバ再起動時にデータが消える）。
- **用途**:
  - Webアプリケーションのセッション管理。
  - 頻繁にアクセスされるデータのキャッシュ（例: データベースクエリ結果）。

---

### **2. Redis**
- **概要**:
  - 高速なインメモリデータストアで、キャッシュ、メッセージブローカー、データベースとしても使用可能。
- **特徴**:
  - キーと値のペアだけでなく、リスト、セット、ハッシュなどのデータ構造をサポート。
  - 永続化機能（データをディスクに保存）を持つため、再起動後もデータを保持可能。
  - Pub/Sub（パブリッシュ/サブスクライブ）機能をサポート。
- **用途**:
  - キャッシュサーバ、ランキングシステム、リアルタイム分析。
  - セッション管理やキューシステム。

---

### **3. Varnish**
- **概要**:
  - WebアプリケーションのHTTPリクエストを高速化するためのリバースプロキシキャッシュ。
- **特徴**:
  - 主に動的なWebコンテンツのキャッシュに特化。
  - 高いパフォーマンスを発揮し、Webサーバの負荷を軽減。
  - VCL（Varnish Configuration Language）を使用して柔軟なキャッシュポリシーを設定可能。
- **用途**:
  - Webサイトのページロード時間短縮。
  - 高トラフィックなWebアプリケーションのパフォーマンス向上。

---

### **4. Apache Kafka**
- **概要**:
  - 厳密にはキャッシュツールではなく、分散型メッセージングシステムですが、一部のユースケースでキャッシュとして利用されることがあります。
- **特徴**:
  - 高スループットでリアルタイムデータストリームを処理。
  - データの保持期間を設定可能。
- **用途**:
  - リアルタイムデータのキャッシュやログ管理。
  - データストリームの一時的な保存。

---

### **5. Nginx（キャッシュ機能）**
- **概要**:
  - 高性能なWebサーバおよびリバースプロキシとして知られていますが、キャッシュ機能も備えています。
- **特徴**:
  - 静的コンテンツや動的コンテンツのキャッシュをサポート。
  - ロードバランサーとしても使用可能。
- **用途**:
  - Webアプリケーションの静的リソース（画像、CSS、JSなど）のキャッシュ。
  - 動的コンテンツのキャッシュによるバックエンド負荷軽減。

---

### **6. AWS ElastiCache**
- **概要**:
  - AWSが提供するフルマネージドなキャッシュサービス。
  - MemcachedまたはRedisをベースにしたキャッシュを提供。
- **特徴**:
  - スケーラブルで高可用性。
  - AWSインフラと統合されており、簡単にセットアップ可能。
- **用途**:
  - クラウド環境でのキャッシュサーバ。
  - セッションストアやデータベースクエリ結果のキャッシュ。

---

### **7. Squid**
- **概要**:
  - HTTP/HTTPSプロキシサーバで、キャッシュ機能を備えています。
- **特徴**:
  - Webコンテンツのキャッシュを行い、帯域幅の節約やレスポンス速度の向上を実現。
  - アクセス制御やログ機能も提供。
- **用途**:
  - Webコンテンツのキャッシュ。
  - ネットワーク帯域幅の最適化。

---

### **比較表**

| ツール名        | 主な用途                       | 特徴                                 |
| --------------- | ------------------------------ | ------------------------------------ |
| Memcached       | シンプルなキャッシュ           | 軽量、高速、揮発性                   |
| Redis           | 高機能キャッシュ、多用途       | 永続化、データ構造のサポート         |
| Varnish         | HTTPリバースプロキシキャッシュ | Webコンテンツの高速化                |
| Apache Kafka    | リアルタイムデータキャッシュ   | 高スループット、データストリーム処理 |
| Nginx           | Webサーバのキャッシュ          | 静的/動的コンテンツのキャッシュ      |
| AWS ElastiCache | クラウド環境でのキャッシュ     | フルマネージド、スケーラブル         |
| Squid           | Webプロキシキャッシュ          | 帯域幅の節約、アクセス制御           |

---

これらのツールは、アプリケーションの要件（速度、スケーラビリティ、データ永続性など）に応じて選択されます。

##### CDN(Contents Delivery Network)
地理的に分散したサーバのネットワークで、CDNサーバでは、画像、動画、CSS、JavaScriptファイルといった静的なコンテンツをキャッシュする。

##### メッセージキュー
ある程度時間のかかる処理を非同期的に実行したい場合に使われる。

例<br>
①Webサーバがメッセージキューにとある処理のジョブを発行する。<br>
②メッセージキューのジョブを処理するサーバ（ワーカー）は、メッセージキューからジョブを受け取って、<br>
Webサーバとは非同期に処理を実行することができる。

キューのサイズが大きければ、ワーカーを追加して処理時間を短縮する。<br>
キューがほとんど空であれば、ワーカーの数を減らすことで処理時間を調整することができる。


`Apache Kafka`, `Redis`, `Amazon SQS`がメッセージキューとして用いられる。

※`Redis`(REmote DIctionary Server)

##### 垂直スケーリング(スケールアップ)
ハードウェアのスペック(CPU, メモリ, ストレージなど)そのものの容量を大きくするといった方法で、
リソースを増強すること。ハードウェアとしての限界がある。

##### 水平スケーリング(シャーディング)
Webサーバの台数を増やす、データベースをシャードというパーツに分割して管理するなど、
並列処理するマシンを増やすようなアプローチでリソースを増強すること。

##### NoSQL(非リレーショナルデータベース)
代表的なNoSQLとしては、以下のようなものがある。
| データベース    | タイプ                    | 主な用途                             | 特徴                                 |
| --------------- | ------------------------- | ------------------------------------ | ------------------------------------ |
| CouchDB         | ドキュメント指向          | 分散システム、オフライン対応         | JSON形式、REST API、レプリケーション |
| Neo4j           | グラフデータベース        | ソーシャルネットワーク、推薦システム | グラフ構造、Cypherクエリ言語         |
| Cassandra       | 分散型NoSQL（カラム指向） | IoT、ログデータ、リアルタイム分析    | 高スケーラビリティ、可用性重視       |
| HBase           | 分散型NoSQL（カラム指向） | ビッグデータ、リアルタイム処理       | Hadoopエコシステム、HDFS上に構築     |
| Amazon DynamoDB | キーバリューストア        | サーバーレスアプリ、IoT              | AWS提供、オンデマンドスケーリング    |

NoSQLでは、結合がサポートされていない。

NoSQLは、以下のような場合に適している場合がある。
- アプリケーションに超低遅延が必要な場合
- 非構造化データを扱う場合、リレーショナルデータがない場合
- データのシリアライズ⇔デシリアライズだけが必要な場合(JSON, XML, YAMLなど)
- 大量データの保存が必要な場合


##### CAP定理
一貫性(Consistency), 可用性(Availability), 分断耐性(Partition Tolerance)
